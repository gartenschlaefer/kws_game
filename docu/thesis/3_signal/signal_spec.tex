% --
% spectrogram

\section{Spectral Features}\label{sec:signal_spec}
Spectral features for audio signals usually incorporate frequency information and are therefore the most intuitive form to represent them.
By calculating a spectrogram, it is possible to observe active energy regions of certain frequency bands at consecutive time chunks.
Methodically the time chunks are expressed by shifting an \emph{analytic window} of time span $t_N$, on the time axis.
The time shifting of the analytic window is performed with a fixed time interval, denoted as \emph{hop time} $t_{h}$.
Both time parameters $t_N$ and $t_h$ can also be presented in samples through a multiplication with the sampling frequency $f_s$:
% --
% samples
\begin{equation}
  \begin{split}
    N &= t_N f_s, \\
    h &= t_h f_s.
  \end{split}
\end{equation}
Note that shifting an analytic window of sample size $N$ with hop size $h$ will create a new resolution on the time axis, denoted as \emph{frames}.
The transformation of the audio samples $x[n]$ with sample index $n$, contained by the analytic window of size $N$, to the frequency space, can be achieved with the Discrete Fourier Transform (DFT):
% --
% DFT
\begin{equation}\label{eq:signal_spec_dtft}
  \hat{x}[k] = \sum_{n=0}^{N-1} x[n] \, e^{-j\frac{2 \pi n}{N}k}
\end{equation}
where $\hat{x}[k] \in \C$ is the transformed signal with frequency index $k$.
More conveniently, \req{signal_spec_dtft} can be written in matrix notation with the DFT operator denoted as $\mathcal{F} \in \C^{K \times N}$ with a total number of $N$ samples of the input signal $\bm{x} \in \R^N$ and $K$ Fourier coefficients:
%--
% DFT matrix
\begin{equation}\label{eq:signal_spec_dtft_matrix}
  \begin{aligned}
    \hat{\bm{x}} = \mathcal{F} \bm{x} \quad \mathrm{with} 
    \quad &\mathcal{F}[k, n] = e^{-j\frac{2 \pi n}{N} k},\\
    &k, n = (0, 1, \dots, K-1), (0, 1 \dots, N-1)
  \end{aligned}
\end{equation}
where $k$ and $n$ are row and column indices in the transformation matrix $\mathcal{F}$ and $\hat{\bm{x}} \in \C^K$ is the transformed signal in vector notation.

The length of the analytic window in samples $N$ is crucial for the frequency resolution and the lowest frequency that can be represented.
For example, the time duration of a periodic signal with frequency $f=\SI{20}{\hertz}$ is $t=\frac{1}{f} = \SI{50}{\milli\second}$.
To represent a waveform, it is necessary to have at least a quarter of its wavelength captured.
Within this thesis, the length of the analytic window is selected to \SI{25}{\milli\second}, which is enough for speech signals.

The \emph{hop size} $h$ in samples of the hop time $t_h$, by which the analytical window is shifted on the time axis, indicates the resolution in time and is especially important for sequential changes within the audio data.
In applications like speech processing the hop time should be selected, so that the fastest pronounced phonemes and its transitions to other phonemes are captured with sufficient resolution.
Usually a hop time of $t_{h}=\SI{10}{\milli\second}$ is chosen for speech recognition tasks (also used within this thesis) but an extension to $t_{h}=\SI{20}{\milli\second}$ is also possible, as demonstrated by \cite{Peter2020}.

With the hop size $h$ in samples and $N$ the length of the analytical window, the Short-Time Fourier Transform (STFT) for discrete time signals, can be computed as:
% --
% stft
\begin{equation}\label{eq:signal_spec_stft}
    \tilde{X}[k, m] = \sum_{n=0}^{N-1} x[n + m h] \, w[n] \, e^{-j\frac{2 \pi n}{N}k}, \qquad m = 0, 1, \dots, M
\end{equation}
so that $\tilde{X}[k, m] \in \C$ is the STFT coefficient of frame $m$ and DFT coefficient $k$, where $n$ is denoted here as summation index, $w$ as a window function, such as the \emph{Hanning} window, $m$ indicates the frame index shifted by the hop size $h$ and $M$ is the maximum number of frames.
The maximum number of frames $M$ is the total number of shifts of an analytical window of size $N$ by the hop size $h$ and can therefore be computed as:
% --
% hop
\begin{equation}\label{eq:signal_spec_hop}
  M = \ceil*{\frac{\norm{\bm{x}}_0-N}{h}}
\end{equation}
where $\norm{\bm{x}}_0$ is denoted as length of the signal vector $\bm{x}$.
The calculation of the STFT can be written in matrix notation if the input chunks from the shifting of the analytic window is denoted as vector:
\begin{equation}
  \bm{x}_m = [x_{m h}, \dots, x_{m h+N}]^T
\end{equation}
where each individual $\bm{x}_m \in \R^N$ can be concatenated in a matrix $X \in \R^{N \times M}$ denoted as:
\begin{equation}
  X = [\bm{x}_0, \bm{x}_1, \dots, \bm{x}_M]
\end{equation}
so that the STFT $\tilde{X} \in \C^{K \times M}$ can be conveniently written as:
% --
% stft matrix
\begin{equation}\label{eq:signal_spec_stft_matrix}
  \tilde{X} = \mathcal{F} \diag{\bm{w}} X
\end{equation}
where $\diag{\bm{w}}$ is a diagonal matrix of weight vectors with a realization of a window function $\bm{w} \in \R^N$ in vector notation.
The matrix $\tilde{X} \in \C^{K \times M}$ represents the whole STFT, where the rows correspond to Fourier coefficients and the columns to frames.
The used STFT parameters for this thesis are listed in \rtab{signal_spec_stft}.
\input{./3_signal/tables/tab_signal_spec_stft.tex}
A spectrogram $P \in \R^{K \times M}$ is simply the power spectrum of the STFT $\tilde{X} \in \C^{K \times M}$ computed as:
\begin{equation}\label{eq:signal_spec_spec}
  P = \abs{\tilde{X}}^2.
\end{equation}
Note that $P$ consists of real values instead of complex ones.
The recorded examples transformed to a spectrogram with linear representation is shown in \rfig{signal_spec_lin_showcase}.
\begin{figure}[!ht]
  \centering
    \subfigure[left]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-lin_showcase_left0.png}}
    \subfigure[right]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-lin_showcase_right0.png}}
    \subfigure[up]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-lin_showcase_up0.png}}
    \subfigure[down]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-lin_showcase_down0.png}}
    \subfigure[go]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-lin_showcase_go0.png}}
  \caption{Linear scaled spectrogram of the showcase examples.}
  \label{fig:signal_spec_lin_showcase}
\end{figure}
\FloatBarrier
\noindent
It can be observed that most of the signal's energy is located in the lower frequency regions of under approximately \SI{1}{\kilo\hertz}.
To ensures that small energies are more emphasized, it is more appealing to logarithmic scale the value space of the spectrogram, achieved by for instance the calculation of the decibel scale of the spectrogram $P_{DB} \in \R^{K \times M}$ as follows:
\begin{equation}\label{eq:signal_spec_log}
  P_{DB} = 10 \cdot \log_{10}{P}.
\end{equation}
The showcase examples of the logarithmic scaled spectrogram and log scaled frequency space is visualized in \rfig{signal_spec_log_showcase}, where it is possible to observe some interesting structures and movements in certain frequency bands over time.
\begin{figure}[!ht]
  \centering
    \subfigure[left]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-log_showcase_left0.png}}
    \subfigure[right]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-log_showcase_right0.png}}
    \subfigure[up]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-log_showcase_up0.png}}
    \subfigure[down]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-log_showcase_down0.png}}
    \subfigure[go]{\includegraphics[width=0.45\textwidth]{./3_signal/figs/signal_spec-log_showcase_go0.png}}
  \caption{Logarithmic scaled spectrogram of the showcase examples.}
  \label{fig:signal_spec_log_showcase}
\end{figure}
\FloatBarrier
\noindent
A compression scheme, such as the MFCC, explained in the next section, reduces the high dimensional frequency feature vectors of the spectrogram to more compact feature vectors.