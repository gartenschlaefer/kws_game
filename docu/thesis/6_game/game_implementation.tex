% --
% game interactables

\section{KWS Game Implementation}
\thesisStateNotReady
The game implementation mainly consists of three essential parts:
\begin{itemize}
	\item online system for the audio stream
	\item classification system of key words
	\item the video game itself.
\end{itemize}
The online system captures the microphone audio stream in real-time and stores it in a FIFO (First In First Out) buffer and calculates the features for the classification system.
The classification system consists of a neural network architecture for classifying the key words.
The video game interprets the commands from the classification systems to real actions within the game.
Detailed descriptions are provided below.


% --
% online

\subsection{Online System}
The length of the FIFO buffer is the sample length, a speech command for classification, is trained for, in this case \SI{500}{\milli\second} or 8000 samples, plus puffer samples for detecting the highest energy region.
The recorded files in the speech command dataset have a length of \SI{1}{\second}, which is too much for the FIFO buffer and would make the classification of key words slower.
A better size of the FIFO buffer including puffer samples is about \SI{750}{\milli\second} or 12000 samples.
The puffer samples are located prior to a key word onset and posterior.
The prior puffer samples are collected consecutive from the audio stream and are updated to the length of the prior puffer samples in the FIFO until a key word onset is detected and the FIFO is filled to its full size plus the posterior samples.
If the FIFO is filled completely when a key word onset was detected, the whole FIFO is read out and the samples are passed to the feature extraction module.
The feature extraction module extracts the highest energy region of the collected samples and computes the MFCC features for a CNN network or just it does some basic pre-processing, such as normalization, for a Wavenet network expecting raw audio samples.

%The advantage of the prior puffer samples that the previous located puffer samples are cheap as the FIFO buffer is updated to the length of the previous puffer samples until a key word onset is detected and the FIFO is filled to its full size.


% --
% classification

\subsection{Classification System}
The classification system consists of a classifier, which is composed of a trained neural network architecture for the classification the key words (speech commands).
The trained weights of a neural network are stored in the \texttt{.pth} format for \texttt{Pytorch}.
A separate parameter file is stored that provide information of the unique name (id) of the neural network architecture, the feature extraction parameters and the class dictionary.
Feature extraction parameters are necessary for the feature extraction module to determine which constellation of features were used during training, so that the same scheme is same-wise applied for inference to classify given samples.
The class dictionary describes which output node of the neural network corresponds to which speech command, this is especially important because of the presence of different sets of labels and therefore the prevention of wrong inference by mixing up the labels.
After the settings and parameters were loaded, the classifier simply does an inference to the most probable key word in its class dictionary.

